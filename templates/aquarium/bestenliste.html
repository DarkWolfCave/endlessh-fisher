{% extends "base.html" %}
{% load game_tags %}

{% block title %}Bestenliste - {{ GAME_NAME }}{% endblock %}

{% block content %}
<div style="margin-bottom: 1.5rem;">
    <h2 style="font-size: 1.25rem; font-weight: 700; color: var(--color-accent);">
        &#x1F3C6; Bestenliste
    </h2>
</div>

<!-- Top 10 Tables -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">

    <!-- Longest Traps -->
    <div class="game-card">
        <h3 style="font-weight: 700; color: var(--color-accent); margin-bottom: 1rem;">
            &#x23F1; Längste Fänge
        </h3>
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 1px solid var(--color-border); font-size: 0.75rem; color: var(--color-text-muted);">
                    <th style="text-align: left; padding: 0.5rem 0;">#</th>
                    <th style="text-align: left; padding: 0.5rem 0;">Fischart</th>
                    <th style="text-align: left; padding: 0.5rem 0;">Server</th>
                    <th style="text-align: right; padding: 0.5rem 0;">Trap-Zeit</th>
                </tr>
            </thead>
            <tbody>
                {% for catch in longest %}
                <tr style="border-bottom: 1px solid var(--color-border);">
                    <td style="padding: 0.5rem 0; color: {% if forloop.counter <= 3 %}var(--color-legendary){% else %}var(--color-text-muted){% endif %}; font-weight: 700;">
                        {% if forloop.counter == 1 %}&#x1F947;{% elif forloop.counter == 2 %}&#x1F948;{% elif forloop.counter == 3 %}&#x1F949;{% else %}{{ forloop.counter }}{% endif %}
                    </td>
                    <td style="padding: 0.5rem 0;">
                        <a href="{% url 'aquarium:fish-detail' pk=catch.pk %}" style="text-decoration: none; color: {{ catch.species.rarity_color }};">
                            {{ catch.species.css_class|species_emoji }} {{ catch.species.name_de }}
                        </a>
                    </td>
                    <td style="padding: 0.5rem 0; font-size: 0.8rem; color: var(--color-text-muted);">{{ catch.server.name }}</td>
                    <td style="padding: 0.5rem 0; text-align: right; font-weight: 700; color: var(--color-accent);">{{ catch.trapped_seconds|duration_format }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="4" style="padding: 1rem 0; text-align: center; color: var(--color-text-muted);">Noch keine Fänge.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Highest Scores -->
    <div class="game-card">
        <h3 style="font-weight: 700; color: var(--color-legendary); margin-bottom: 1rem;">
            &#x2B50; Höchste Scores
        </h3>
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 1px solid var(--color-border); font-size: 0.75rem; color: var(--color-text-muted);">
                    <th style="text-align: left; padding: 0.5rem 0;">#</th>
                    <th style="text-align: left; padding: 0.5rem 0;">Fischart</th>
                    <th style="text-align: left; padding: 0.5rem 0;">Server</th>
                    <th style="text-align: right; padding: 0.5rem 0;">Score</th>
                </tr>
            </thead>
            <tbody>
                {% for catch in highest_score %}
                <tr style="border-bottom: 1px solid var(--color-border);">
                    <td style="padding: 0.5rem 0; color: {% if forloop.counter <= 3 %}var(--color-legendary){% else %}var(--color-text-muted){% endif %}; font-weight: 700;">
                        {% if forloop.counter == 1 %}&#x1F947;{% elif forloop.counter == 2 %}&#x1F948;{% elif forloop.counter == 3 %}&#x1F949;{% else %}{{ forloop.counter }}{% endif %}
                    </td>
                    <td style="padding: 0.5rem 0;">
                        <a href="{% url 'aquarium:fish-detail' pk=catch.pk %}" style="text-decoration: none; color: {{ catch.species.rarity_color }};">
                            {{ catch.species.css_class|species_emoji }} {{ catch.species.name_de }}
                        </a>
                    </td>
                    <td style="padding: 0.5rem 0; font-size: 0.8rem; color: var(--color-text-muted);">{{ catch.server.name }}</td>
                    <td style="padding: 0.5rem 0; text-align: right; font-weight: 700; color: var(--color-legendary);">{{ catch.score|score_format }}</td>
                </tr>
                {% empty %}
                <tr><td colspan="4" style="padding: 1rem 0; text-align: center; color: var(--color-text-muted);">Noch keine Fänge.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Species Records -->
<div class="game-card">
    <h3 style="font-weight: 700; color: var(--color-accent); margin-bottom: 1rem;">
        &#x1F3C5; Rekorde pro Fischart
    </h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 0.75rem;">
        {% for entry in species_records %}
        <a href="{% url 'aquarium:fish-detail' pk=entry.record.pk %}"
           style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--color-surface-2); border-radius: 0.5rem; border: 1px solid var(--color-border);">
            <span style="font-size: 1.5rem; color: {{ entry.species.rarity_color }};" class="glow-{{ entry.species.rarity }}">
                {{ entry.species.css_class|species_emoji }}
            </span>
            <div style="flex: 1; min-width: 0;">
                <div style="font-weight: 700; color: {{ entry.species.rarity_color }};">{{ entry.species.name_de }}</div>
                <div style="font-size: 0.75rem; color: var(--color-text-muted);">{{ entry.record.server.name }}</div>
            </div>
            <div style="text-align: right;">
                <div style="font-weight: 700; color: var(--color-accent);">{{ entry.record.trapped_seconds|duration_format }}</div>
                <div style="font-size: 0.75rem; color: var(--color-legendary);">{{ entry.record.score|score_format }} Pkt.</div>
            </div>
        </a>
        {% endfor %}
    </div>
</div>
{% endblock %}
